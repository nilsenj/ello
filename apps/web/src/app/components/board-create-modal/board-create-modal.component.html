<section
        *ngIf="modal.isOpen()"
        class="fixed inset-0 z-[1000] grid place-items-center bg-black/50 backdrop-blur-sm"
        (mousedown)="onBackdrop($event)"
        role="dialog"
        aria-modal="true"
>
    <div
            class="w-[min(92vw,760px)] max-w-[760px] max-h-[calc(100vh-48px)] bg-white rounded-xl shadow-2xl flex flex-col"
            (mousedown)="$event.stopPropagation()"
    >
        <!-- header -->
        <header class="relative px-5 py-3 border-b border-slate-200">
            <div
                    class="absolute inset-x-0 top-0 h-1"
                    [style.background]="bgType()==='color' ? bgValue() : 'transparent'"
            ></div>

            <div class="flex items-center gap-2 text-slate-800">
                <span class="font-semibold text-[15px]">Create board</span>
                <span class="ml-1 inline-flex items-center rounded-md bg-slate-100 px-2 py-0.5 text-xs text-slate-600">
          Trello-style
        </span>
                <button
                        class="ml-auto inline-flex h-8 w-8 items-center justify-center rounded-md hover:bg-slate-100"
                        (click)="close()"
                        aria-label="Close"
                >
                    <lucide-icon [img]="XIcon" class="h-4 w-4 text-slate-600"></lucide-icon>
                </button>
            </div>
        </header>

        <!-- body -->
        <div class="flex-1 overflow-auto px-5 py-4">
            <!-- preview -->
            <div class="mb-4 overflow-hidden rounded-xl shadow-lg">
                <div
                        class="h-40 rounded-lg shadow-inner p-3 text-slate-900 flex flex-col"
                        [ngStyle]="{
      'background': bgType()==='color' ? bgValue() : (bgValue() ? 'url(' + bgValue() + ')' : '#e5e7eb'),
      'backgroundSize': 'cover',
      'backgroundPosition':'center'
    }"
                >
                    <div class="font-semibold mb-2">
                        {{ name().trim() || 'Board title' }}
                    </div>

                    <!-- one row, top-aligned, centered -->
                    <div class="flex items-start justify-center gap-3">
                        <!-- List A (1 item) -->
                        <div class="w-28 rounded-md bg-white/85 shadow-sm p-2">
                            <p class="text-[11px] font-medium text-slate-700/90 blur-[1.8px] select-none"
                               aria-hidden="true">
                                Backlog
                            </p>
                            <div class="mt-1 space-y-1.5">
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Draft homepage hero copy for review
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- List B (2 items) -->
                        <div class="w-36 rounded-md bg-white/85 shadow-sm p-2">
                            <p class="text-[11px] font-medium text-slate-700/90 blur-[1.8px] select-none"
                               aria-hidden="true">
                                In Progress
                            </p>
                            <div class="mt-1 space-y-1.5">
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Implement auth flow & session restore
                                    </p>
                                </div>
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Connect board list API and cache queries
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- List C (1 item, wider) -->
                        <div class="w-44 rounded-md bg-white/85 shadow-sm p-2">
                            <p class="text-[11px] font-medium text-slate-700/90 blur-[1.8px] select-none"
                               aria-hidden="true">
                                Review / QA
                            </p>
                            <div class="mt-1 space-y-1.5">
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Cross-browser testing (Safari, Chrome, Firefox)
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- List D (2 items, hidden on small screens) -->
                        <div class="hidden md:block w-28 rounded-md bg-white/85 shadow-sm p-2">
                            <p class="text-[11px] font-medium text-slate-700/90 blur-[1.8px] select-none"
                               aria-hidden="true">
                                Done
                            </p>
                            <div class="mt-1 space-y-1.5">
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Migrate icons to Lucide
                                    </p>
                                </div>
                                <div class="rounded bg-white/90 shadow p-1.5">
                                    <p class="text-[10px] leading-4 text-slate-700/90 blur-[2px] select-none"
                                       aria-hidden="true">
                                        Add Trello-style board modal
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- form -->
            <div class="grid gap-4">
                <label class="grid gap-1">
                    <span class="text-sm font-medium text-slate-700">Board title</span>
                    <input
                            class="h-9 w-full rounded-md border border-slate-300 bg-white px-3 text-sm text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-400/50 focus:border-slate-400"
                            autofocus
                            placeholder="e.g., Marketing Q1"
                            [ngModel]="name()"
                            (ngModelChange)="name.set($event)"
                    />
                </label>

                <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                    <!-- background -->
                    <label class="block">
            <span class="inline-flex items-center gap-1 text-sm font-medium text-slate-700">
              <lucide-icon [img]="PaletteIcon" class="h-4 w-4 text-slate-500"></lucide-icon>
              Background
            </span>

                        <div class="mt-2 grid grid-cols-9 gap-2">
                            <button
                                    *ngFor="let c of colorPresets"
                                    type="button"
                                    class="h-7 w-7 rounded-md border-2 border-white shadow hover:shadow-md transition"
                                    [style.background]="c"
                                    [class.outline]="bgType()==='color' && bgValue()===c"
                                    [class.outline-2]="bgType()==='color' && bgValue()===c"
                                    [class.outline-white]="bgType()==='color' && bgValue()===c"
                                    (click)="pickColor(c)"
                                    aria-label="Pick color"
                            ></button>
                        </div>

                        <ng-container *ngIf="imagePresets.length">
                            <div class="mt-2 grid grid-cols-5 gap-2">
                                <button
                                        *ngFor="let url of imagePresets"
                                        type="button"
                                        class="relative aspect-[4/3] w-full rounded-lg border-2 border-white bg-cover bg-center overflow-hidden"
                                        [style.backgroundImage]="'url(' + url + ')'"
                                        [class.outline]="bgType()==='image' && bgValue()===url"
                                        [class.outline-2]="bgType()==='image' && bgValue()===url"
                                        [class.outline-white]="bgType()==='image' && bgValue()===url"
                                        (click)="pickImage(url)"
                                        aria-label="Pick image"
                                >
                                    <lucide-icon [img]="ImageIcon"
                                                 class="absolute right-1.5 bottom-1.5 h-3.5 w-3.5 text-slate-100/90"></lucide-icon>
                                </button>
                            </div>
                        </ng-container>
                    </label>

                    <!-- visibility -->
                    <label class="grid gap-1">
            <span class="inline-flex items-center gap-1 text-sm font-medium text-slate-700">
              <lucide-icon [img]="GlobeIcon" class="h-4 w-4 text-slate-500"></lucide-icon>
              Visibility
            </span>
                        <select
                                class="h-9 w-full rounded-md border border-slate-300 bg-white px-3 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-400/50 focus:border-slate-400"
                                [ngModel]="visibility()"
                                (ngModelChange)="visibility.set($event)"
                        >
                            <option value="private">Private</option>
                            <option value="workspace">Workspace</option>
                            <option value="public">Public</option>
                        </select>
                        <div
                                class="mt-1 text-[12px] text-slate-500"
                                [innerHTML]="
                visibility()==='private' ? 'Only board members can view and edit.' :
                visibility()==='workspace' ? 'Workspace members can find and join.' :
                'Anyone with a link can view.'">
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- footer -->
        <footer class="sticky bottom-0 border-t border-slate-200 bg-white px-4 py-3 flex justify-end gap-2">
            <button
                    class="inline-flex items-center rounded-md border border-slate-300 bg-white px-3 py-1.5 text-sm text-slate-700 hover:bg-slate-50"
                    (click)="close()"
            >
                Cancel
            </button>
            <button
                    class="inline-flex items-center rounded-md bg-slate-800 px-3 py-1.5 text-sm text-white disabled:opacity-50 hover:bg-slate-900"
                    [disabled]="!canSubmit() || creating()"
                    (click)="createBoard()"
            >
                <span *ngIf="!creating()">Create</span>
                <span *ngIf="creating()">Creatingâ€¦</span>
            </button>
        </footer>
    </div>
</section>
