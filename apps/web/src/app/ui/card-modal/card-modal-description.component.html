<section>
    <div class="cm-section-title">{{ tDescription }}</div>

    <div *ngIf="!isEditingDesc && !descDraft?.trim()" class="cm-btn inline-flex items-center"
        (click)="startDescEdit()" [class.cursor-not-allowed]="!canEdit" [class.opacity-60]="!canEdit">
        <lucide-icon [img]="PlusIcon" class="mr-1"></lucide-icon>
        {{ canEdit ? tAddDescription : tNoDescription }}
    </div>

    <div *ngIf="!isEditingDesc && (descDraft?.trim()?.length || 0) > 0" class="space-y-2">
        <div class="prose prose-sm max-w-none cm-description" [innerHTML]="richDescription(descDraft) | safeHtml">
        </div>
        <div *ngIf="canEdit">
            <button class="cm-btn inline-flex items-center" (click)="startDescEdit()">
                <lucide-icon [img]="PencilIcon" class="mr-1"></lucide-icon>
                {{ tEdit }}
            </button>
        </div>
    </div>

    <div *ngIf="isEditingDesc && canEdit" class="space-y-3">
        <div
            class="border border-slate-300 rounded-md overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 shadow-sm transition-all duration-200">
            <div class="bg-gray-50 border-b border-slate-200 px-2 py-1.5 flex gap-1 items-center">
                <button type="button"
                    class="p-1.5 rounded hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"
                    (click)="wrapSelection(descInput, '**','**')" [attr.title]="tBold">
                    <lucide-icon [img]="BoldIcon" class="w-4 h-4"></lucide-icon>
                </button>
                <button type="button"
                    class="p-1.5 rounded hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"
                    (click)="wrapSelection(descInput, '_','_')" [attr.title]="tItalic">
                    <lucide-icon [img]="ItalicIcon" class="w-4 h-4"></lucide-icon>
                </button>
                <div class="w-px h-4 bg-slate-300 mx-1"></div>
                <button type="button"
                    class="p-1.5 rounded hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"
                    (click)="insertPrefix(descInput, '- ')" [attr.title]="tList">
                    <lucide-icon [img]="ListIcon" class="w-4 h-4"></lucide-icon>
                </button>
                <button type="button"
                    class="p-1.5 rounded hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"
                    (click)="makeHeading(descInput)" [attr.title]="tHeading">
                    <lucide-icon [img]="Heading1Icon" class="w-4 h-4"></lucide-icon>
                </button>
                <div class="w-px h-4 bg-slate-300 mx-1"></div>
                <button type="button"
                    class="p-1.5 rounded hover:bg-slate-200 text-slate-600 hover:text-slate-900 transition-colors"
                    (click)="insertLink(descInput)" [attr.title]="tLink">
                    <lucide-icon [img]="LinkIcon" class="w-4 h-4"></lucide-icon>
                </button>
            </div>

            <textarea #descInput
                class="w-full min-h-[160px] p-3 text-sm focus:outline-none bg-white resize-y cm-textarea" rows="8"
                [ngModel]="descDraft" (ngModelChange)="descDraft = $event"
                [placeholder]="tAddDescription"></textarea>
        </div>

        <div class="flex items-center justify-between">
            <div class="flex gap-2">
                <button class="cm-btn-primary inline-flex items-center" type="button" (click)="saveDescription()">
                    {{ tSave }}
                </button>
                <button class="cm-btn inline-flex items-center" (click)="cancelDescEdit()">
                    {{ tCancel }}
                </button>
            </div>
            <span class="text-xs text-slate-400">
                {{ descCharCount | number }} {{ tCharacters }}
            </span>
        </div>
    </div>
</section>
