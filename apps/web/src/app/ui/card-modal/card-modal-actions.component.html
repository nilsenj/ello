<section *ngIf="canArchive || canMoveCopy || canDelete">
    <div class="cm-section-title">{{ tActions }}</div>
    <div class="grid grid-cols-2 gap-2">
        <button *ngIf="canArchive" class="cm-add inline-flex items-center" (click)="archiveCard()">
            <lucide-icon [img]="ArchiveIcon" class="mr-1"></lucide-icon>
            {{ tArchive }}
        </button>
        <button *ngIf="canMoveCopy" class="cm-add inline-flex items-center" (click)="prepareMoveOrCopy('move')">
            <lucide-icon [img]="MoveIcon" class="mr-1"></lucide-icon>
            {{ tMove }}
        </button>
        <button *ngIf="canMoveCopy" class="cm-add inline-flex items-center" (click)="prepareMoveOrCopy('copy')">
            <lucide-icon [img]="CopyIcon" class="mr-1"></lucide-icon>
            {{ tCopy }}
        </button>
        <button *ngIf="canDelete" class="cm-add inline-flex items-center text-red-600 hover:bg-red-50"
            (click)="deleteCard()">
            <lucide-icon [img]="Trash2Icon" class="mr-1"></lucide-icon>
            {{ tDelete }}
        </button>
    </div>
</section>

<section *ngIf="isPanelOpen('move')" data-panel="move">
    <div class="cm-section-title flex items-center gap-2">
        <span class="inline-flex items-center">
            <lucide-icon [img]="MoveIcon" class="mr-1"></lucide-icon>
            {{ tMoveCard }}
        </span>
        <button class="cm-link inline-flex items-center ml-auto" (click)="closePanel()">
            <lucide-icon [img]="XIcon"></lucide-icon>
            {{ tClose }}
        </button>
    </div>

    <div class="space-y-3">
        <label class="cm-field">
            <span class="cm-field-label">{{ tBoard }}</span>
            <select class="cm-input" [ngModel]="targetBoardId()" (ngModelChange)="onTargetBoardChange($event)">
                <option *ngFor="let b of availableBoards" [value]="b.id">{{ b.name }}</option>
            </select>
        </label>

        <label class="cm-field">
            <span class="cm-field-label">{{ tList }}</span>
            <div *ngIf="isBusyAction()" class="cm-muted text-xs mb-1">{{ tLoadingLists }}</div>
            <select class="cm-input" [ngModel]="targetListId()" (ngModelChange)="targetListId.set($event)"
                [disabled]="isBusyAction()">
                <option *ngFor="let l of targetLists" [value]="l.id">{{ l.title || l.name }}</option>
            </select>
        </label>

        <label class="cm-field">
            <span class="cm-field-label">{{ tPosition }}</span>
            <select class="cm-input" [ngModel]="targetPosition()" (ngModelChange)="targetPosition.set($event)">
                <option value="top">{{ tTop }}</option>
                <option value="bottom">{{ tBottom }}</option>
            </select>
        </label>

        <button class="cm-btn-primary w-full justify-center" (click)="doMove()"
            [disabled]="isBusyAction() || !targetListId()">
            {{ tMove }}
        </button>
    </div>
</section>

<section *ngIf="isPanelOpen('copy')" data-panel="copy">
    <div class="cm-section-title flex items-center gap-2">
        <span class="inline-flex items-center">
            <lucide-icon [img]="CopyIcon" class="mr-1"></lucide-icon>
            {{ tCopyCard }}
        </span>
        <button class="cm-link inline-flex items-center ml-auto" (click)="closePanel()">
            <lucide-icon [img]="XIcon"></lucide-icon>
            {{ tClose }}
        </button>
    </div>

    <div class="space-y-3">
        <label class="cm-field">
            <span class="cm-field-label">{{ tTitle }}</span>
            <textarea class="cm-input" rows="2" [ngModel]="copyTitle()" (ngModelChange)="copyTitle.set($event)">
            </textarea>
        </label>

        <label class="cm-field">
            <span class="cm-field-label">{{ tBoard }}</span>
            <select class="cm-input" [ngModel]="targetBoardId()" (ngModelChange)="onTargetBoardChange($event)">
                <option *ngFor="let b of availableBoards" [value]="b.id">{{ b.name }}</option>
            </select>
        </label>

        <label class="cm-field">
            <span class="cm-field-label">{{ tList }}</span>
            <div *ngIf="isBusyAction()" class="cm-muted text-xs mb-1">{{ tLoadingLists }}</div>
            <select class="cm-input" [ngModel]="targetListId()" (ngModelChange)="targetListId.set($event)"
                [disabled]="isBusyAction()">
                <option *ngFor="let l of targetLists" [value]="l.id">{{ l.title || l.name }}</option>
            </select>
        </label>

        <button class="cm-btn-primary w-full justify-center" (click)="doCopy()"
            [disabled]="isBusyAction() || !targetListId() || !copyTitle().trim()">
            {{ tCopy }}
        </button>
    </div>
</section>

<section *ngIf="isPanelOpen('delete')" data-panel="delete">
    <div class="cm-section-title flex items-center gap-2 text-red-700">
        <span class="inline-flex items-center">
            <lucide-icon [img]="Trash2Icon" class="mr-1"></lucide-icon>
            {{ tDeleteCardPrompt }}
        </span>
        <button class="cm-link inline-flex items-center ml-auto text-ink-base" (click)="closePanel()">
            <lucide-icon [img]="XIcon"></lucide-icon>
            {{ tClose }}
        </button>
    </div>

    <div class="space-y-3">
        <p class="text-sm text-ink-sub">
            {{ tDeleteWarning }}
        </p>

        <button class="cm-btn-primary w-full justify-center bg-red-600 hover:bg-red-700 text-white border-transparent"
            (click)="doDelete()" [disabled]="isBusyAction()">
            {{ isBusyAction() ? tDeleting : tDelete }}
        </button>
    </div>
</section>
