<div class="relative inline-flex items-center" (focusout)="onBlur($event)" clickOutside (clickOutside)="close()">
    <button
        class="pill h-8 px-2 sm:px-3 flex items-center gap-1 sm:gap-2 hover:bg-white/30 transition-colors text-white"
        (click)="toggle()">
        <span class="truncate max-w-[80px] sm:max-w-[150px] font-medium leading-none">{{ currentBoardName() }}</span>
        <svg class="w-4 h-4 opacity-80 shrink-0" viewBox="0 0 20 20" fill="currentColor">
            <path d="M5.25 7.5l4.5 4.5 4.5-4.5" />
        </svg>
    </button>


    <div class="menu-content mt-1 w-80 origin-top-left max-h-[500px] overflow-y-auto" *ngIf="isOpen()">
        <div class="px-4 py-2 border-b border-gray-100 sticky top-0 bg-white z-10">
            <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider">{{ tYourBoards }}
            </div>
        </div>
        <div class="py-1">
            <div *ngFor="let group of boardsByWorkspace()">
                <!-- Workspace Header -->
                <div
                    class="px-4 py-2 text-xs font-semibold text-gray-400 uppercase tracking-wider bg-gray-50 sticky top-[41px] z-[9]">
                    {{ group.workspaceName }}
                </div>
                <!-- Boards in this workspace -->
                <div class="px-2 py-1">
                    <button *ngFor="let b of group.boards"
                        class="w-full text-left px-3 py-2 rounded hover:bg-gray-50 flex items-center gap-2 group"
                        [class.bg-blue-50]="b.id === currentBoardId()" [class.text-blue-700]="b.id === currentBoardId()"
                        (click)="switchBoard.emit(b.id); close()">
                        <span class="w-8 h-6 rounded bg-cover bg-center shrink-0 border border-gray-200"
                            [ngClass]="getBoardBackgroundClass(b.background)">
                        </span>
                        <span class="truncate font-medium text-sm">{{ b.name }}</span>
                        <span *ngIf="b.id === currentBoardId()" class="ml-auto text-blue-600">
                            <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
